# Initial idea of repoman checks: https://github.com/mrueg/repoman-travis

# use "Trusty" as "Precise" has bash 4.2 only, which doesn't support nameref vars
sudo: required
dist: trusty
language: python
python:
    - "3.4" # repoman seems to be fastest with python-3.4
addons:
    apt:
        sources:
            - debian-sid
        packages:
            - shellcheck

git:
    depth: 1
branches:
    only:
        - master
        - dev
        - /^ci\//

## env config and env-based matrix
env:
    global:
        ## configurable variables
        - OVERLAY_NAME='rindeal'
    matrix:
        - PORTAGE_VER="2.3.0" REPOMAN_VER="2.3.0"
        - SHELLCHECK=1
## final touches to the matrix
matrix:
    fast_finish: true
    allow_failures:
            - env: SHELLCHECK=1

cache:
    pip: true
    directories:
        - ${VIRTUAL_ENV}/lib/python${TRAVIS_PYTHON_VERSION}/site-packages/
before_cache:
    - rm -v -f ${HOME}/.cache/pip/log/debug.log

# -----------------------------------------------------------------------------

before_install:
    - source .travis/setup_environment.sh

install:
    - .travis/run_install.sh

script:
    - .travis/run_tests.sh

# after_success:
#     - cd "${TRAVIS_BUILD_DIR}"
#     - .travis/setup_git.sh

# -----------------------------------------------------------------------------

notifications:
  email: false
  hipchat:
    rooms:
      secure: IStd9nRQehPWV9UbY326zsA87n51FsuckeUGa8vxNuKYMmc7MElQK5ApnHy5b9PbHzPVs6M2FIGQB/zcipa9H/jFrw4q9yk3IWKLvbxt1CYsxWdt6v4H4NwLwv1UMZ1umodH0BCQ1jXApB252CiqitXrhVrx7WRyWQs40vNJ6NJJBpFquo+t4hugR1xE6JVkeobmUhXukazAN5cKxO2jie2kOqvXNszjznIMmeyA4Ud+Wi6J0EwzQnSyepHxuugQUEbWDuroe0DlyNG84jWP2G3oLC5t7DjPmhjeSKPkQ5FVM08k65tPaaA9v0ZpxYD3HunjdtAAQDrHdcNYTrNF8fbDcGL/I+B0nxELBO1IDTXAerZ6xiCE00CKoMZh5XLKkQZhvsu64Ize6z5766LWyopKRCSi6Pzx/H44nNwaP9OHexGBgEIFs6MTTlquGytYP0CtFd7SgJ0w0mo0vMttqOFBR+b6S3ilCbXfJex9NPRVCqfGqmN3fy0Q+H1aXYWr+8PSPA1jsKarPyBdtRevnd63oAKWyu3y7Ga3oUUWcsWn8x/JsOJHrojnEIEQ9uVr2G92wmsh9MnLHZGDWwyHW/UoVvJsA54EHMRbC6Rfe+ub+/c878uJovAFD/6HWNGwNj1cMJIKKfMIj0UYQ0yrmAyruugsNOjb864uURmMcTg=
    notify: true
