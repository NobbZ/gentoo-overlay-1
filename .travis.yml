# Initial idea of repoman checks: https://github.com/mrueg/repoman-travis

sudo: false
language: python
python:
    - "3.4"

git:
    depth: 1
branches:
    only:
        - master
        - dev
        - /^ci\//

env:
    global:
        ## configurable variables
        - OVERLAY_NAME='rindeal'
        - PORTAGE_ROOT="$(mktemp -d --suffix=-PORTAGE_ROOT)"
        ## do not modify these
        - PORTAGE_CONFIGROOT="${PORTAGE_ROOT}" ROOT="${PORTAGE_ROOT}"
        - PORTAGE_GRPNAME='root' PORTAGE_USERNAME='root'    # silences crappy warnings
    matrix:
        - PORTAGE_VER="2.3.0" REPOMAN_VER="2.3.0"

matrix:
    fast_finish: true

cache:
    pip: true
    directories:
        - ${VIRTUAL_ENV}/lib/python${TRAVIS_PYTHON_VERSION}/site-packages/
before_cache:
    - rm -v -f ${HOME}/.cache/pip/log/debug.log


install:
    - pip --verbose install 'lxml>=3.6,<3.7'
    - .travis/install_portage.sh
    - export PATH="${PORTAGE_ROOT}/usr/bin:${PATH}"

script:
    - repoman full --xmlparse --verbose --without-mask

# after_success:
#     - cd "${TRAVIS_BUILD_DIR}"
#     - git config user.name "Travis CI"
#     - git config user.email "Travis@CI"
#     - git reset --hard $TRAVIS_COMMIT


notifications:
    email:
        on_success: never
        on_failure: never
